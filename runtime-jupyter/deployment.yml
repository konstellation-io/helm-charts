apiVersion: apps/v1
kind: Deployment
metadata:
  name: enterprise-gateway
  namespace: kdl
  labels:
    gateway-selector: enterprise-gateway
    app: enterprise-gateway
    component: enterprise-gateway
spec:
  # Uncomment/Update to deploy multiple replicas of EG
  #  replicas: 1
  selector:
    matchLabels:
      gateway-selector: enterprise-gateway
  template:
    metadata:
      labels:
        gateway-selector: enterprise-gateway
        app: enterprise-gateway
        component: enterprise-gateway
    spec:
      # Created above.
      # serviceAccountName: enterprise-gateway-sa
      containers:
      - env:
        - name: EG_PORT
          value: "8888"
        - name: EG_RESPONSE_PORT
          value: "8877"
        # Created above.
        - name: EG_NAMESPACE
          value: "kdl"
        # Created above.  Used if no KERNEL_NAMESPACE is provided by client.
        - name: EG_KERNEL_CLUSTER_ROLE
          value: "kernel-controller"
        # All kernels reside in the EG namespace if True, otherwise KERNEL_NAMESPACE
        # must be provided or one will be created for each kernel.
        - name: EG_SHARED_NAMESPACE
          value: "False"
        - name: EG_TUNNELING_ENABLED
          value: "False"
        - name: EG_CULL_IDLE_TIMEOUT
          value: "600"
        - name: EG_LOG_LEVEL
          value: "DEBUG"
        - name: EG_KERNEL_LAUNCH_TIMEOUT
          value: "60"
        - name: EG_KERNEL_WHITELIST
          # value: "'r_kubernetes','python_kubernetes','python_tf_kubernetes','scala_kubernetes','spark_r_kubernetes','spark_python_kubernetes','spark_scala_kubernetes'"
          value: "'python_kubernetes'"
        - name: EG_DEFAULT_KERNEL_NAME
          value: "python_kubernetes"
        # Optional authorization token passed in all requests (see --EnterpriseGatewayApp.auth_token)
        #- name: EG_AUTH_TOKEN
        #  value: <configured-auth-token>
        # Ensure the following VERSION tag is updated to the version of Enterprise Gateway you wish to run
        image: elyra/enterprise-gateway:2.5.2 # https://hub.docker.com/r/elyra/enterprise-gateway/tags
        imagePullPolicy: Always
        name: enterprise-gateway
        args: ["--gateway"]
        ports:
        - containerPort: 8888
        - containerPort: 8877
